<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Center</title>
    <link rel="stylesheet" href="/css/admin_home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="/img/LaTiPee-small.png">
</head>
<body>
    <nav>
        <div class="logo">
            <img src="/img/logo.png">
        </div>

        <div class="title-nav">
            <span>Admin Center</span>
        </div>
    </nav>

    <main>
        <div class="table-content" id="user-tab">
            <div class="table-header">
                <h3>Quản lý tài khoản người dùng</h3>
            </div>
            <div class="table-body">
                <table>
                    <thead>
                        <th>Tên người dùng</th>
                        <th>Email</th>
                        <th>Loại tài khoản</th>
                        <th>Giao dịch gần đây</th>
                        <th>Trạng thái tài khoản</th>
                        <th></th>
                    </thead>
                    <tbody>
                        <% users.forEach(user => { %>
                            <tr data-user-id="<%= user.id %>">
                                <td><%= user.userName %></td>
                                <td><%= user.email %></td>
                                <td><%= user.admin === 'y' ? 'Quản Trị Viên' : 'Người Dùng' %></td>
                                <td><%= user.lastTransactionDate %></td>
                                <td>
                                    <% if (user.userName !== 'SuperAdmin') { %>
                                        <select class="account-status-select">
                                            <option <%= user.status === '1' ? 'selected' : '' %> value="1">Hoạt động</option>
                                            <option <%= user.status === '0' ? 'selected' : '' %> value="0">Bị cấm</option>
                                        </select>
                                    <% } else { %>
                                        <%= user.status === '1' ? 'Hoạt động' : 'Bị cấm' %>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (user.userName !== 'SuperAdmin') { %>
                                        <button class="save-button" data-user-id="<%= user.id %>">Lưu</button>
                                    <% } %>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
            
        </div>

        <div class="table-content table-content-product">
            <div class="table-header">
                <h3>Quản lý tất cả bài đăng sản phẩm</h3>
            </div>
            <div class="table-body">
                <table>
                    <thead>
                        <th></th>
                        <th>Tên sản phẩm</th>
                        <th>Chi tiết sản phẩm</th>
                        <th>lượt mua</th>
                        <th>Ngày đăng</th>
                        <th>Chủ shop</th>
                        <th>Trạng thái bài đăng</th>
                        <th></th>
                    </thead>
                    <tbody>
                        <% products.forEach(product => { %>
                            <tr>
                                <td>
                                    <img src="<%= product.imageURL %>" alt="<%= product.name %>">
                                </td>
                                <td><%= product.name %></td>
                                <td><%= product.description %></td>
                                <td><%= product.sold %></td>
                                <td><%= product.date %></td>
                                <td><%= product.shopName %></td>
                                <td>
                                    <select class="product-status-select">
                                        <option <%= product.status === 'Cho phép' ? 'selected' : '' %> value="Cho phép">Cho phép</option>
                                        <option <%= product.status === 'Đình chỉ' ? 'selected' : '' %> value="Đình chỉ">Đình chỉ</option>
                                        <option <%= product.status === 'Xoá' ? 'selected' : '' %> value="Xoá">Xoá</option>
                                    </select>
                                </td>   
                                <td>
                                    <button class="save-product-button" data-product-id="<%= product.id %>">Lưu</button>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-logo">
            <img src="/img/LaTiPee Logo.png" width="200px">
        </div>
        <div class="about">
            <h3>Giới thiệu:</h3>
            <ul>
                <li><a href="#">Về chúng tôi</a></li>
                <li><a href="#">Điều khoản sử dụng</a></li>
                <li><a href="#">Chính sách bảo mật</a></li>
            </ul>
        </div>
        <div class="contact">
            <h3>Liên Hệ:</h3>
            <ul>
                <li><a href="#">Hotline: 1900 0000</a></li>
                <li><a href="#">Email:
    </footer>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(() => {
        $('.account-status-select').on('change', function () {
            const userId = $(this).closest('tr').data('user-id');
            const newStatus = $(this).val();
            const newType = ''; // Implement a way to get the new account type here

            $.ajax({
                url: '/admin/update-user-status',
                method: 'POST',
                data: { userId, newStatus, newType },
                success: function (response) {
                    console.log(response); // Handle success, update UI if needed
                },
                error: function (error) {
                    console.error(error); // Handle error
                }
            });
        });

        $('.save-button').on('click', function () {
            const userId = $(this).data('user-id');
            const newStatus = $(this).closest('tr').find('.account-status-select').val();
            const newType = ''; // Implement a way to get the new account type here

            $.ajax({
                url: '/admin/update-user-status',
                method: 'POST',
                data: { userId, newStatus, newType },
                success: function (response) {
                    console.log(response); // Handle success, update UI if needed
                },
                error: function (error) {
                    console.error(error); // Handle error
                }
            });
        });
    });
</script>
<script>
    $(document).ready(() => {
        $('.save-product-button').on('click', function () {
            const saveButton = $(this);
            const productId = saveButton.data('product-id');
            const newStatus = saveButton.closest('tr').find('.product-status-select').val();

            $.ajax({
                url: '/admin/update-product-status',
                method: 'POST',
                data: { productId, newStatus },
                success: function (response) {
                    console.log(response); // Handle success, update UI if needed
                    
                    // Update the select options to reflect the new status
                    const selectElement = saveButton.closest('tr').find('.product-status-select');
                    selectElement.val(newStatus);
                },
                error: function (error) {
                    console.error(error); // Handle error
                }
            });
        });
    });
</script>
</body>
</html>